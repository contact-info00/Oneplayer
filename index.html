<script>
  const API_KEY = "AIzaSyAiZDuUwQMfUaP7ToFZfIdNrRRTwIqcfi0";
  const searchInput = document.getElementById('search-input');
  const resultsDiv = document.getElementById('results');
  const favList = document.getElementById('fav-list');

  let currentAudioFrame = null;

  searchInput.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
      searchYouTube(searchInput.value);
    }
  });

  window.onload = () => loadFavorites();

  function searchYouTube(query) {
    fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=20&q=${encodeURIComponent(query)}&key=${API_KEY}`)
      .then(res => res.json())
      .then(data => {
        resultsDiv.innerHTML = '';
        data.items.forEach(item => {
          const videoId = item.id.videoId;
          const title = item.snippet.title;
          const thumbnail = item.snippet.thumbnails.medium.url;

          const card = document.createElement('div');
          card.className = 'video-card';
          card.innerHTML = `
            <img src="${thumbnail}" alt="${title}">
            <p>${title}</p>
            <button onclick="playAudio('${videoId}')">Play</button>
            <button onclick="addToFavorites('${videoId}', '${title.replace(/'/g, "\\'")}')">Favorite</button>
          `;
          resultsDiv.appendChild(card);
        });
      });
  }

  function playAudio(videoId) {
    // Remove previous iframe if exists
    if (currentAudioFrame) {
      currentAudioFrame.remove();
    }

    // Create hidden iframe to simulate audio playback
    currentAudioFrame = document.createElement('iframe');
    currentAudioFrame.style.width = "1px";
    currentAudioFrame.style.height = "1px";
    currentAudioFrame.style.position = "absolute";
    currentAudioFrame.style.left = "-9999px";
    currentAudioFrame.setAttribute("allow", "autoplay");
    currentAudioFrame.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&rel=0&modestbranding=1`;

    document.body.appendChild(currentAudioFrame);
  }

  function addToFavorites(videoId, title) {
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    if (!favorites.find(f => f.id === videoId)) {
      favorites.push({ id: videoId, title });
      localStorage.setItem('favorites', JSON.stringify(favorites));
      loadFavorites();
    }
  }

  function loadFavorites() {
    favList.innerHTML = '';
    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    favorites.forEach(fav => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="#" onclick="playAudio('${fav.id}')">${fav.title}</a>`;
      favList.appendChild(li);
    });
  }
</script>
